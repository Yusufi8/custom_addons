<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- ================================================= -->
    <!-- Time Off Approvals : LIST VIEW -->
    <!-- ================================================= -->
    <template id="portal_timeoff_approvals_list">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>

            <t t-call="portal.portal_searchbar">
                <t t-set="title">Time Off Approvals</t>
            </t>

            <div class="o_portal_wrap">
                <div class="container mt-4">

                    <h3 class="mb-3">Time Off Approvals</h3>

                    <t t-if="not approvals">
                        <div class="alert alert-info">
                            <i class="fa fa-info-circle"/>
                            No pending approvals found.
                        </div>
                    </t>

                    <t t-else="">
                        <table class="table table-hover o_portal_my_doc_table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Leave Type</th>
                                    <th>Dates</th>
                                    <th>Days</th>
                                    <th>Docs</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>

                            <tbody>
                                <t t-foreach="approvals" t-as="leave">
                                    <tr>

                                        <!-- Employee -->
                                        <td>
                                            <a t-att-href="'/my/timeoff/approvals/%s' % leave.id">
                                                <t t-esc="leave.employee_id.name"/>
                                            </a>
                                        </td>

                                        <!-- Leave Type -->
                                        <td>
                                            <t t-esc="leave.holiday_status_id.name"/>
                                        </td>

                                        <!-- Dates -->
                                        <td>
                                            <t t-esc="leave.request_date_from"/>
                                            â†’
                                            <t t-esc="leave.request_date_to"/>
                                        </td>

                                        <!-- Days -->
                                        <td>
                                            <t t-esc="leave.number_of_days"/>
                                        </td>

                                        <!-- Native Supporting Documents Count -->
                                        <td>
                                            <t t-if="approvals_attachments_count_map.get(leave.id)">
                                                ðŸ“Ž
                                                <t t-esc="approvals_attachments_count_map.get(leave.id)"/>
                                            </t>
                                            <t t-else="">â€”</t>
                                        </td>

                                        <!-- Actions -->
                                        <td>
                                            <a t-att-href="'/my/timeoff/approve/%s' % leave.id"
                                               class="btn btn-success btn-sm me-1"
                                               title="Approve">
                                                <i class="fa fa-check"/>
                                            </a>
                                            <a t-att-href="'/my/timeoff/refuse/%s' % leave.id"
                                               class="btn btn-danger btn-sm me-1"
                                               title="Refuse">
                                                <i class="fa fa-times"/>
                                            </a>
                                            <t t-if="leave.state in ('draft', 'confirm')">
                                                <a t-att-href="'/my/timeoff/approvals/delete/%s' % leave.id"
                                                   class="btn btn-outline-danger btn-sm"
                                                   onclick="return confirm('Are you sure you want to delete this request?')"
                                                   title="Delete">
                                                    <i class="fa fa-trash"/>
                                                </a>
                                            </t>
                                        </td>

                                    </tr>
                                </t>
                            </tbody>
                        </table>

                        <!-- Pager: show only when multiple pages -->
                        <t t-if="pager and pager['page_count'] &gt; 1">
                            <nav aria-label="Page navigation" class="mt-3">
                                <ul class="pagination">
                                    <!-- Prev -->
                                    <li t-att-class="'page-item %s' % ('disabled' if pager['page']['num'] == 1 else '')">
                                        <t t-if="pager['page']['num'] == 1">
                                            <span class="page-link">Prev</span>
                                        </t>
                                        <t t-else="">
                                            <a t-att-href="pager['page_previous']['url']" class="page-link">Prev</a>
                                        </t>
                                    </li>

                                    <!-- Page numbers -->
                                    <t t-foreach="pager['pages']" t-as="p">
                                        <li t-att-class="'page-item %s' % ('active' if p['num'] == pager['page']['num'] else '')">
                                            <t t-if="p['num'] == pager['page']['num']">
                                                <span class="page-link"><t t-esc="p['num']"/></span>
                                            </t>
                                            <t t-else="">
                                                <a t-att-href="p['url']" class="page-link"><t t-esc="p['num']"/></a>
                                            </t>
                                        </li>
                                    </t>

                                    <!-- Next -->
                                    <li t-att-class="'page-item %s' % ('disabled' if pager['page']['num'] == pager['page_count'] else '')">
                                        <t t-if="pager['page']['num'] == pager['page_count']">
                                            <span class="page-link">Next</span>
                                        </t>
                                        <t t-else="">
                                            <a t-att-href="pager['page_next']['url']" class="page-link">Next</a>
                                        </t>
                                    </li>
                                </ul>
                            </nav>
                        </t>

                    </t>

                </div>
            </div>
        </t>
    </template>


    <!-- ================================================= -->
    <!-- Time Off Approval : DETAILS VIEW -->
    <!-- ================================================= -->
    <template id="portal_timeoff_approval_details">
        <t t-call="portal.portal_layout">

            <div class="container">
                <div class="row mt-4">

                    <!-- Main Content -->
                    <div class="col-lg-9">
                        <div class="card">
                            <div class="card-header bg-white">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Approval Request â€” <span t-field="leave.employee_id"/></h5>
                                    <t t-if="form_pager">
                                        <nav aria-label="Record navigation">
                                            <ul class="pagination pagination-sm mb-0">
                                                <li t-att-class="'page-item %s' % ('disabled' if not form_pager.get('prev_url') else '')">
                                                    <t t-if="form_pager.get('prev_url')">
                                                        <a t-att-href="form_pager.get('prev_url')" class="page-link">&#171;</a>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="page-link">&#171;</span>
                                                    </t>
                                                </li>
                                                <li class="page-item disabled"><span class="page-link"> <t t-esc="form_pager.get('index')"/> / <t t-esc="form_pager.get('total')"/> </span></li>
                                                <li t-att-class="'page-item %s' % ('disabled' if not form_pager.get('next_url') else '')">
                                                    <t t-if="form_pager.get('next_url')">
                                                        <a t-att-href="form_pager.get('next_url')" class="page-link">&#187;</a>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="page-link">&#187;</span>
                                                    </t>
                                                </li>
                                            </ul>
                                        </nav>
                                    </t>
                                </div>
                            </div>

                            <div class="card-body">

                                <!-- Leave Info -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <strong>Leave Type:</strong>
                                        <div>
                                            <span t-field="leave.holiday_status_id"/>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <strong>Days:</strong>
                                        <div>
                                            <span t-field="leave.number_of_days"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <strong>Start Date:</strong>
                                        <div>
                                            <span t-field="leave.request_date_from"/>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <strong>End Date:</strong>
                                        <div>
                                            <span t-field="leave.request_date_to"/>
                                        </div>
                                    </div>
                                </div>

                                <!-- Native Supporting Documents -->
                                <div class="row mt-4">
                                    <div class="col-12">
                                        <h6>
                                            Supporting Documents
                                            <span class="badge bg-secondary">
                                                <t t-esc="attachments_count"/>
                                            </span>
                                        </h6>

                                        <t t-if="leave.supported_attachment_ids">
                                            <ul class="list-unstyled">
                                                <t t-foreach="leave.supported_attachment_ids" t-as="att">
                                                    <li class="d-flex justify-content-between align-items-center">
                                                        <div>
                                                            ðŸ“Ž
                                                            <a t-att-href="'/web/content/%s?download=true' % att.id"
                                                               target="_blank">
                                                                <t t-esc="att.name"/>
                                                            </a>
                                                        </div>
                                                        <t t-if="leave.state in ('draft', 'confirm')">
                                                            <a t-att-href="'/my/timeoff/attachment/delete/%s' % att.id"
                                                               class="btn btn-sm btn-danger"
                                                               onclick="return confirm('Delete this document?')"
                                                               title="Delete">
                                                                <i class="fa fa-trash"/>
                                                            </a>
                                                        </t>
                                                    </li>
                                                </t>
                                            </ul>
                                        </t>

                                        <t t-else="">
                                            <span class="text-muted">No documents</span>
                                        </t>
                                    </div>
                                </div>

                                <!-- Actions -->
                                <div class="row mt-4">
                                    <div class="col-12">
                                        <a t-att-href="'/my/timeoff/approve/%s' % leave.id"
                                           class="btn btn-success me-2">
                                            <i class="fa fa-check"/> Approve
                                        </a>
                                        <a t-att-href="'/my/timeoff/refuse/%s' % leave.id"
                                           class="btn btn-danger me-2">
                                            <i class="fa fa-times"/> Refuse
                                        </a>
                                        <t t-if="leave.state in ('draft', 'confirm')">
                                            <a t-att-href="'/my/timeoff/approvals/delete/%s' % leave.id"
                                               class="btn btn-outline-danger"
                                               onclick="return confirm('Are you sure you want to delete this request?')">
                                                <i class="fa fa-trash"/> Delete
                                            </a>
                                        </t>
                                    </div>
                                </div>

                                <!-- Chatter -->
                                <div class="row mt-4">
                                    <div class="col-12">
                                        <h6>Messages and Communication History</h6>
                                        <div class="o_portal_chatter" t-att-data-res_model="'hr.leave'" t-att-data-res_id="leave.id">
                                            <t t-call="portal.message_thread">
                                                <t t-set="object" t-value="leave"/>
                                            </t>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div class="col-lg-3">
                        <div class="card">
                            <div class="card-body">
                                <a href="/my/home" class="btn btn-secondary w-100 mb-2">
                                    <i class="fa fa-home"/> Home
                                </a>
                                <a href="/my/timeoff/approvals" class="btn btn-secondary w-100">
                                    <i class="fa fa-arrow-left"/> Back
                                </a>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </t>
    </template>

</odoo>
